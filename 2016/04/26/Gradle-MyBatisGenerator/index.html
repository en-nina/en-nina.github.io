<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="nina"><link rel="alternative" href="/atom.xml" title="O₂" type="application/atom+xml"><link rel="icon" href="/favicon.png"><title>Intellij IDEA 中结合 Gradle 使用 MyBatis Generator 逆向生成代码 - O₂</title><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/js/fancybox/jquery.fancybox.min.css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--><script src="/js/jquery-3.1.1.min.js"></script><script src="/js/fancybox/jquery.fancybox.min.js"></script></head><body style="opacity:0"><header class="head"><h1 class="head-title u-fl"><a href="/">O₂</a></h1><nav class="head-nav u-fr"><ul class="head-nav__list"><li class="head-nav__item"><a class="head-nav__link" href="/archives">カタログ/（目录）</a></li></ul></nav></header><main class="main"><article class="post"><header class="post__head"> <time class="post__time" datetime="2016-04-26T10:17:26.000Z">四月 26, 2016</time><h1 class="post__title"><a href="/2016/04/26/Gradle-MyBatisGenerator/">Intellij IDEA 中结合 Gradle 使用 MyBatis Generator 逆向生成代码</a></h1><div class="post__main echo"><p>在 Intellij IDEA 中结合 Gradle 使用 MyBatis Generator 逆向生成代码</p>
<ul>
<li>JDK 1.8</li>
<li>Gradle 3.5</li>
<li>Intellij IDEA 2017</li>
</ul>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>Intellij IDEA 的教程较少，且 MyBatis Generator 不支持 Gradle 直接运行，因此这次是在自己折腾项目过程中，根据一些参考资料加上自己的实践得出的结论，并附上相应的 Demo 可供自己未来参考，也与大家分享。</p>
<p>本文的 Demo 也可以当作工具直接导入 IDEA，加上自己的数据库信息即可生成代码。</p>
<h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><p>创建步骤可以参考<a href="http://oxy.pub/2016/04/22/ssm1/">intellij idea 2016 gradle搭建web工程</a>中。当创建完毕，需要等待 Gradle 联网构建，由于国内网络因素，可能需要稍作等待。当构建完成，目录结构应如下图一致：</p>
<p><img src="/2016/04/26/Gradle-MyBatisGenerator/step1.png" alt="step1"></p>
<h2 id="配置依赖"><a href="#配置依赖" class="headerlink" title="配置依赖"></a>配置依赖</h2><p>这里需要使用 MyBatis Generator，MySQL 驱动，以及 MyBatis Mapper。由于代码生成单独运行即可，不需要参与到整个项目的编译，因此在 build.gradle 中添加配置：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">configurations &#123;</span><br><span class="line">mybatisGenerator</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">testCompile <span class="string">group:</span> <span class="string">'junit'</span>, <span class="string">name:</span> <span class="string">'junit'</span>, <span class="string">version:</span> <span class="string">'4.11'</span></span><br><span class="line"></span><br><span class="line">mybatisGenerator <span class="string">'org.mybatis.generator:mybatis-generator-core:1.3.5'</span></span><br><span class="line">mybatisGenerator <span class="string">'mysql:mysql-connector-java:5.1.40'</span></span><br><span class="line">mybatisGenerator <span class="string">'tk.mybatis:mapper:3.3.9'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="设置数据库信息"><a href="#设置数据库信息" class="headerlink" title="设置数据库信息"></a>设置数据库信息</h2><p>在 resources 下，新建 mybatis 文件夹，并新建 jdbc.properties 和 generatorConfig.xml，文件结构如下：</p>
<p><img src="/2016/04/26/Gradle-MyBatisGenerator/step2.png" alt="step1"></p>
<p>在 config.properties 中配置数据库和要生成的 Java 类的包：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">jdbc.driver=com.mysql.jdbc.Driver</span><br><span class="line">jdbc.url=jdbc:mysql://192.168.1.11:3306/ssmDemo?characterEncoding=utf8</span><br><span class="line">jdbc.username=root</span><br><span class="line">jdbc.password=111111</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 生成实体类所在的包</span><br><span class="line">package.model=org.zn.user.entity</span><br><span class="line"># 生成 mapper 类所在的包</span><br><span class="line">package.mapper=org.zn.user.dao</span><br><span class="line"># 生成 mapper xml 文件所在的包，默认存储在 resources 目录下</span><br><span class="line">package.xml=mapping</span><br><span class="line"># 表名</span><br><span class="line">package.tableName=user</span><br><span class="line"># 生成实体类名称</span><br><span class="line">package.entityName=User</span><br></pre></td></tr></table></figure>
<h2 id="设置生成代码的配置文件"><a href="#设置生成代码的配置文件" class="headerlink" title="设置生成代码的配置文件"></a>设置生成代码的配置文件</h2><p>在 generatorConfig.xml 中配置数据库表信息，可以参考官方的文档（附在文末）来进行配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE generatorConfiguration</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">"Mysql"</span> <span class="attr">targetRuntime</span>=<span class="string">"MyBatis3Simple"</span> <span class="attr">defaultModelType</span>=<span class="string">"flat"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suppressAllComments"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suppressDate"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"javaFileEncoding"</span> <span class="attr">value</span>=<span class="string">"utf-8"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">"$&#123;driverClass&#125;"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">connectionURL</span>=<span class="string">"$&#123;connectionURL&#125;"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">userId</span>=<span class="string">"$&#123;userId&#125;"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">password</span>=<span class="string">"$&#123;password&#125;"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">jdbcConnection</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"forceBigDecimals"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">"$&#123;modelPackage&#125;"</span> <span class="attr">targetProject</span>=<span class="string">"$&#123;src_main_java&#125;"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"enableSubPackages"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"trimStrings"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">"$&#123;sqlMapperPackage&#125;"</span> <span class="attr">targetProject</span>=<span class="string">"$&#123;src_main_resources&#125;"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"enableSubPackages"</span> <span class="attr">value</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- type="ANNOTATEDMAPPER",生成Java Model 和基于注解的Mapper对象</span></span><br><span class="line"><span class="comment">             type="MIXEDMAPPER",生成基于注解的JavaModel 和相应的Mapper对象</span></span><br><span class="line"><span class="comment">             type="XMLMAPPER",生成SQLMap XML文件和独立的Mapper接口  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">targetPackage</span>=<span class="string">"$&#123;mapperPackage&#125;"</span> <span class="attr">targetProject</span>=<span class="string">"$&#123;src_main_java&#125;"</span> <span class="attr">type</span>=<span class="string">"XMLMAPPER"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"enableSubPackages"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 这种方式是所有的表逆向生成类 下面是单个表具体看情况使用</span></span><br><span class="line"><span class="comment">        &lt;table tableName="%"&gt;</span></span><br><span class="line"><span class="comment">            &lt;generatedKey column="epa_id" sqlStatement="Mysql" identity="true" /&gt;</span></span><br><span class="line"><span class="comment">        &lt;/table&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 要生成的表 tableName是数据库中的表名或视图名 domainObjectName是实体类名--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">"$&#123;tableName&#125;"</span> <span class="attr">domainObjectName</span>=<span class="string">"$&#123;entityName&#125;"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">enableCountByExample</span>=<span class="string">"false"</span> <span class="attr">enableUpdateByExample</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">enableDeleteByExample</span>=<span class="string">"false"</span> <span class="attr">enableSelectByExample</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">selectByExampleQueryId</span>=<span class="string">"false"</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Gradle-设置-Ant-Task"><a href="#Gradle-设置-Ant-Task" class="headerlink" title="Gradle 设置 Ant Task"></a>Gradle 设置 Ant Task</h2><p>由于 MyBatis Generator 尚不支持 Gradle，所以只能使用 Gradle 来执行 Ant Task，达到相同的效果。</p>
<p>build.gradle:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> getDbProperties = &#123;</span><br><span class="line"><span class="keyword">def</span> properties = <span class="keyword">new</span> Properties()</span><br><span class="line">file(<span class="string">"src/main/resources/jdbc.properties"</span>).withInputStream &#123; inputStream -&gt;</span><br><span class="line">properties.load(inputStream)</span><br><span class="line">&#125;</span><br><span class="line">properties</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">task mybatisGenerate &lt;&lt; &#123;</span><br><span class="line">    <span class="keyword">def</span> properties = getDbProperties()</span><br><span class="line">    ant.properties[<span class="string">'targetProject'</span>] = projectDir.path</span><br><span class="line">    ant.properties[<span class="string">'driverClass'</span>] = properties.getProperty(<span class="string">"jdbc.driver"</span>)</span><br><span class="line">    ant.properties[<span class="string">'connectionURL'</span>] = properties.getProperty(<span class="string">"jdbc.url"</span>)</span><br><span class="line">    ant.properties[<span class="string">'userId'</span>] = properties.getProperty(<span class="string">"jdbc.username"</span>)</span><br><span class="line">    ant.properties[<span class="string">'password'</span>] = properties.getProperty(<span class="string">"jdbc.password"</span>)</span><br><span class="line">    ant.properties[<span class="string">'src_main_java'</span>] = sourceSets.main.java.srcDirs[<span class="number">0</span>].path</span><br><span class="line">    ant.properties[<span class="string">'src_main_resources'</span>] = sourceSets.main.resources.srcDirs[<span class="number">0</span>].path</span><br><span class="line">    ant.properties[<span class="string">'modelPackage'</span>] = properties.getProperty(<span class="string">"package.model"</span>)</span><br><span class="line">    ant.properties[<span class="string">'mapperPackage'</span>] = properties.getProperty(<span class="string">"package.mapper"</span>)</span><br><span class="line">    ant.properties[<span class="string">'sqlMapperPackage'</span>] = properties.getProperty(<span class="string">"package.xml"</span>)</span><br><span class="line">    ant.properties[<span class="string">'tableName'</span>] = properties.getProperty(<span class="string">"package.tableName"</span>)</span><br><span class="line">    ant.properties[<span class="string">'entityName'</span>] = properties.getProperty(<span class="string">"package.entityName"</span>)</span><br><span class="line">    ant.taskdef(</span><br><span class="line"><span class="symbol">            name:</span> <span class="string">'mbgenerator'</span>,</span><br><span class="line"><span class="symbol">            classname:</span> <span class="string">'org.mybatis.generator.ant.GeneratorAntTask'</span>,</span><br><span class="line"><span class="symbol">            classpath:</span> configurations.mybatisGenerator.asPath</span><br><span class="line">    )</span><br><span class="line">    ant.mbgenerator(<span class="string">overwrite:</span> <span class="literal">true</span>,</span><br><span class="line"><span class="symbol">            configfile:</span> <span class="string">'src/main/resources/generatorConfig.xml'</span>, <span class="string">verbose:</span> <span class="literal">true</span>) &#123;</span><br><span class="line">        propertyset &#123;</span><br><span class="line">            propertyref(<span class="string">name:</span> <span class="string">'targetProject'</span>)</span><br><span class="line">            propertyref(<span class="string">name:</span> <span class="string">'userId'</span>)</span><br><span class="line">            propertyref(<span class="string">name:</span> <span class="string">'driverClass'</span>)</span><br><span class="line">            propertyref(<span class="string">name:</span> <span class="string">'connectionURL'</span>)</span><br><span class="line">            propertyref(<span class="string">name:</span> <span class="string">'password'</span>)</span><br><span class="line">            propertyref(<span class="string">name:</span> <span class="string">'src_main_java'</span>)</span><br><span class="line">            propertyref(<span class="string">name:</span> <span class="string">'src_main_resources'</span>)</span><br><span class="line">            propertyref(<span class="string">name:</span> <span class="string">'modelPackage'</span>)</span><br><span class="line">            propertyref(<span class="string">name:</span> <span class="string">'mapperPackage'</span>)</span><br><span class="line">            propertyref(<span class="string">name:</span> <span class="string">'sqlMapperPackage'</span>)</span><br><span class="line">            propertyref(<span class="string">name:</span> <span class="string">'tableName'</span>)</span><br><span class="line">            propertyref(<span class="string">name:</span> <span class="string">'entityName'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置好 build.gradle，就可以在 IDEA 的 Gradle 菜单中找到新的 Task：</p>
<p><img src="/2016/04/26/Gradle-MyBatisGenerator/step3.png" alt="step3"></p>
<p>如果这里没有，可能是 Gradle 没有 build，重新刷新即可：</p>
<p><img src="/2016/04/26/Gradle-MyBatisGenerator/step4.png" alt="step4"></p>
<p>双击「mybatisGenerate」即可运行，如果配置正确即可运行成功：</p>
<p><img src="/2016/04/26/Gradle-MyBatisGenerator/step5.png" alt="step5"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>感谢网上博友的无私奉献，参考你们的博文最终得以完成</p>
<p>Gradle+SSM+MyBatis Generator源码地址：<a href="https://github.com/enamor/ssm" target="_blank" rel="noopener">https://github.com/enamor/ssm</a></p>
</div></header><footer class="post__foot u-cf"><ul class="post__tag u-fl"><li class="post__tag__item"><a class="post__tag__link" href="/tags/MyBatis/">MyBatis</a></li></ul></footer></article><div class="comments" id="lv-container" data-id="city" data-uid="your uid"><script>(function(d, s) {var j, e = d.getElementsByTagName(s)[0];if (typeof LivereTower === 'function') { return; } j = d.createElement(s);j.src = 'https://cdn-city.livere.com/js/embed.dist.js';j.async = true;e.parentNode.insertBefore(j, e);})(document, 'script');</script></div></main><footer class="foot"><div class="foot-copy">&copy; 2016-2018 nina</div></footer><script src="/js/scroller.js"></script><script src="/js/main.js"></script></body></html>