<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>iOS组件化一【建立cocoaPods库】 | O₂</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/6.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.2/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">iOS组件化一【建立cocoaPods库】</h1><a id="logo" href="/.">O₂</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">iOS组件化一【建立cocoaPods库】</h1><div class="post-meta">Nov 24, 2018<script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><p><strong>iOS组件化学习之路一 【发布cocoaPods】</strong></p>
<p>由于目前已经做过了好多款项目，积累了一些公用的工具类、分类、UI组件等、考虑到以后项目快速导入、以及组件化的实践、特此进行cocoaPods的探究</p>
<p>自己的公共组件可以放到gitlab 或者 码云上来进行私有库的管理</p>
<p>本文讲的是自己写的一个txt阅读器发布cocoaPods的过程：</p>
<p>1、在github上创建一个自己的公有仓库，并上传源码</p>
<p>2、在终端，cd到你的项目文件目录中，创建podspec文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod spec create CCReader-swift</span><br></pre></td></tr></table></figure>
<p>文件名最好与你的库名字一致，库名字最好不要与pods上其他库名字重复</p>
<p>创建成功后，项目文件目录下会多一个xxxxx.podspec的文件，这个相当于pods仓库的配置文件，配置内容具体如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ edit CCReader-swift.podspec</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># Pod::Spec.new do |s|</span><br><span class="line">s.name             = &quot;CCReader-swift&quot;    #名称</span><br><span class="line">s.version          = &quot;0.0.1&quot;             #版本号</span><br><span class="line">s.summary          = &quot;.txt reader&quot;     	#简短介绍</span><br><span class="line">s.description  = &lt;&lt;-DESC</span><br><span class="line">  .txt reader for  ios				   #详细描述</span><br><span class="line">                   DESC</span><br><span class="line"></span><br><span class="line">s.homepage     = &quot;https://github.com/enamor/CCReader-swift.git&quot;                          </span><br><span class="line">#主页,这里要填写可以git访问到的地址，不然验证不通过</span><br><span class="line"># s.screenshots     = &quot;www.example.com/screenshots_1&quot;, &quot;www.example.com/screenshots_2&quot;           </span><br><span class="line">#截图</span><br><span class="line"></span><br><span class="line">s.license          = &apos;MIT&apos;              #开源协议</span><br><span class="line"></span><br><span class="line">s.source       = &#123; :git =&gt; &quot;https://github.com/enamor/CCReader-swift.git&quot;, :tag =&gt; &quot;#&#123;s.version&#125;&quot; &#125;   </span><br><span class="line">#项目地址，这里不支持ssh的地址，验证不通过，只支持HTTP和HTTPS，最好使用HTTPS</span><br><span class="line"></span><br><span class="line">s.platform     = :ios, &apos;8.0&apos;            #支持的平台及版本</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># s.author           = &#123; &quot;wtlucky&quot; =&gt; &quot;wtlucky@foxmail.com&quot; &#125;                   #作者信息</span><br><span class="line"># s.social_media_url = &apos;https://twitter.com/&lt;twitter_username&gt;&apos;                       #多媒体介绍地址</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># s.requires_arc = true                   #是否使用ARC，如果指定具体文件，则具体的问题使用ARC</span><br><span class="line"></span><br><span class="line">s.source_files  = &quot;CCReader-swift&quot;, &quot;CCReader-swift/Reader/**/*.&#123;h,m,swift&#125;&quot;</span><br><span class="line">#代码源文件地址， //  CCReader-swift 为项目名称    项目名称/源码路径/**/*.&#123;h,m,swift&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># s.resource_bundles = &#123;</span><br><span class="line"># &apos;CCReader-swift&apos; =&gt; [&apos;Pod/Assets/*.png&apos;]</span><br><span class="line"># &#125;                                       #资源文件地址</span><br><span class="line"># s.public_header_files = &apos;Pod/Classes/**/*.h&apos;   #公开头文件地址</span><br><span class="line"># s.frameworks = &apos;UIKit&apos;                  #所需的framework，多个用逗号隔开</span><br><span class="line"># s.dependency &apos;AFNetworking&apos;, &apos;~&gt; 2.3&apos;   #依赖关系，该项目所依赖的其他库，如果有多个需要填写多个s.dependency</span><br><span class="line"># end</span><br></pre></td></tr></table></figure>
<p>然后将代码提交。</p>
<p>这个配置文件的配置内容很重要，配置的对错，会决定你的代码能否成功的推送到pods</p>
<p>3、为你的code打上tag版本号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git tag &apos;0.0.1&apos;</span><br><span class="line">git push --tags</span><br></pre></td></tr></table></figure>
<p>版本号自己确定，与podspec配置文件内的版本号 s.version 相匹配</p>
<p>4、spec配置文件检查</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod spec lint Peanut.podspec</span><br></pre></td></tr></table></figure>
<p>如果不执行第三部会出现以下错误</p>
<ul>
<li>ERROR | [iOS] unknown: Encountered an unknown error ([!] /usr/bin/git clone <a href="https://github.com/enamor/CCReader-swift.git" target="_blank" rel="noopener">https://github.com/enamor/CCReader-swift.git</a> /var/folders/wr/gy6rn23x3vjgq81nyp493xzw0000gn/T/d20181125-2550-1yinelx –template= –single-branch –depth 1 –branch 0.0.1</li>
</ul>
<p>5、如果是swift语言开发的会出现如下提示</p>
<p>the validator used Swift 3.2 by default because no Swift version was specified.</p>
<p>同时可能会出现如下等语法错误</p>
<ul>
<li>ERROR | [iOS] xcodebuild:  /Users/zhouen/Desk。。。。</li>
</ul>
<p>那么究竟可以如何修复这个问题呢？CocoaPods 为此发布了一个修正版。在 lint 时你被要求必须指定 Swift 版本。为了这么做，你必须得创建一个名为 <code>.swift-version</code> 的新文件，并添加编译器版本。只需简单地输出以下命令： </p>
<p><em>在项目目录下进行如下命令</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;4.2&quot; &gt;&gt; .swift-version</span><br></pre></td></tr></table></figure>
<p>现在再次运行 <code>pod lib lint</code>，你应该能够得到一条通过验证的消息：</p>
<p>4、注册trunk</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pod trunk register xxxx@xxxx.com 'xxxx' --description='xxxx' --verbose</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">xxxx@xxxx.com一个可用的邮箱，注册成功之后会收到一份邮件需要点开</span><br><span class="line">--description='xxxx'描述</span><br><span class="line">--verbose如果出现错误，显示更多信息</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">查看自己的信息：</span><br><span class="line">pod trunk me</span><br></pre></td></tr></table></figure>
<p>添加其他维护者</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pod trunk add-owner xxxxxxx xxxxx@xxxx.com</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">	xxxxxxx 库的名字</span><br><span class="line">	xxxxx@xxxx.com 其他人的trunk邮箱</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
<p>5、提交到CocoaPods trunk</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod trunk push --allow-warnings</span><br></pre></td></tr></table></figure>
<p>该操作会对本地的代码及podspec配置文件进行检查，允许警告WARN但不允许报错ERROR</p>
<p>也可以自己手动检查</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod lib lint --allow-warnings</span><br></pre></td></tr></table></figure>
<p> 如果是在项目文件目录下pod lib lint后面不需要跟xxxxx.podspec文件名,–allow-warnings是允许警告</p>
<hr>
<p> 🎉  Congrats</p>
<p> 🚀  CCReader-swift (0.0.1) successfully published</p>
<p> 📅  November 25th, 21:55</p>
<p> 🌎  <a href="https://cocoapods.org/pods/CCReader-swift" target="_blank" rel="noopener">https://cocoapods.org/pods/CCReader-swift</a></p>
<p> 👍  Tell your friends!</p>
<p>-——————————————————————————-</p>
<p>出现上面情况证明已经成功</p>
<p>6、上面的步骤成功之后</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod search 你的库名</span><br></pre></td></tr></table></figure>
<p>就能搜索到了</p>
<p>6、接下来是更新代码，然后推送到pods的流程。</p>
<p>我的代码库里只是一些零散的文件，由于推送到pods的代码不能报错，所以我这里是新建了一个空项目，然后把公共依赖的文件放到一个文件夹内Classes(名字随意)，拖到项目中，在提交的时候先编译一下，确保没有报错。</p>
<p>这样做的同时podspec里</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s.source_files的配置也要改为指定的文件目录：项目名/Classes/**/*.&#123;h,m,swift&#125;</span><br></pre></td></tr></table></figure>
<p>本地文件改动后，提交到git</p>
<p>7、然后重复步骤3，为你的代码打上tag，并推送tag（tag不能重复）</p>
<p>8、然后步骤5推送到trunk，这一步检查的时候很容易失败，报出的错误可以翻译过来针对性的找一下问题，基本意思都很明确</p>
<p>以后在每个项目中之需要在Podfile文件中增加自己的库，然后</p>
<p>pod install</p>
<p>每次有更新 pod update 你的库名</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://oxy.pub/2018/11/24/ios-component1/" data-id="cjveu9gti000k7uyzdx0qxsou" class="article-share-link">分享到</a><div class="tags"><a href="/tags/iOS/">iOS</a></div><div class="post-nav"><a href="/2019/05/08/swiftknowledge/" class="pre">swiftknowledge</a><a href="/2018/10/19/iphoneXseries/" class="next">iphoneX系列适配用的宏定义</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://oxy.pub"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/iOS/">iOS</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Swift/" style="font-size: 15px;">Swift</a> <a href="/tags/Objective-C/" style="font-size: 15px;">Objective-C</a> <a href="/tags/MyBatis/" style="font-size: 15px;">MyBatis</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/Git/" style="font-size: 15px;">Git</a> <a href="/tags/iOS/" style="font-size: 15px;">iOS</a> <a href="/tags/SSM/" style="font-size: 15px;">SSM</a> <a href="/tags/vue/" style="font-size: 15px;">vue</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/github/" style="font-size: 15px;">github</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/05/08/swiftknowledge/">swiftknowledge</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/24/ios-component1/">iOS组件化一【建立cocoaPods库】</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/19/iphoneXseries/">iphoneX系列适配用的宏定义</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/17/vuejs1/">在vuejs 中使用axios不能获取属性data的解决方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/12/uipage/">UIPageViewController上下滑动页面重复Bug解决方案</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/28/PhpStorm-codeStyle/">PHPStorm配置自己喜欢的主题</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/10/macPHPConfig/">Mac系统下配置PHP运行环境</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/09/gitOperate/">Git命令行操作步骤</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/07/PLPlayerPackaging/">基于七牛播放器PLPlayer的二次封装(全屏) 以及七牛iOS播放器各个版本的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/05/01/niplayer/">一句话实现AVPlayer视频播放</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/enamor" title="Github" target="_blank">Github</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">O₂.</a><a rel="nofollow" target="_blank" href="https://oxy.pub"> nina.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.0.47/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>